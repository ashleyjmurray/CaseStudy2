---
title: "Case Study 2: Detecting Stress Using Wearables"
author: "Steven Herrera Tenorio, Ashley Murray, Nathan O'Hara"
date: 10/09/2020
fontsize: 12pt
geometry: "left=1.75cm,right=1.75cm,top=1.75cm,bottom=1.75cm"
output: 
  pdf_document:
     latex_engine: xelatex
     number_sections: true
---

```{r package_test, include=FALSE}
# install packages as needed
pkgTest <- function(x) {
  if (!require(x,character.only = TRUE))
    {
    install.packages(x,repos = "http://cran.r-project.org", dep=TRUE)
    if(!require(x,character.only = TRUE)) stop("Package not found")
    }
}
pkgTest("tidyverse")
pkgTest("cowplot")
pkgTest("reticulate")
pkgTest("ggfortify")
pkgTest("ggplot2")
pkgTest("dplyr")
pkgTest("tidyr")
pkgTest("broom")
pkgTest("car")
pkgTest("olsrr")
pkgTest("corrplot")
pkgTest("reshape2")
pkgTest("caret")
pkgTest("gridExtra")
pkgTest("gridGraphics")
pkgTest("grid")
pkgTest("kableExtra")
pkgTest("knitr")
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE)
ggplot2::theme_set(new = theme_bw())
library(tidyverse)
library(cowplot)
library(reticulate)
library(ggfortify)
library(ggplot2)
library(dplyr)
library(tidyr)
library(broom)
library(car)
library(olsrr)
library(corrplot)
library(reshape2)
library(caret)
library(gridExtra)
library(gridGraphics)
library(grid)
library(kableExtra)
library(knitr)
```

```{r load_data, include=FALSE}
# final: final dataframe collected from the cluster
final <- read_csv("/Volumes/G-DRIVE mobile/CaseStudy2/final.csv") %>% 
  mutate(label = as.factor(label))

# data_table: personalized dataframe to show engineered features in a summarized table
data_table <- read_csv("/Volumes/G-DRIVE mobile/CaseStudy2/data_table.csv", 
                       col_names = c("Sensor", "Features", "Count"))

# lasso_c: top 10 lasso-regression model variables and their associated coefficients
lasso_c <- read_csv("/Volumes/G-DRIVE mobile/CaseStudy2/lasso_c.csv")

# feat_imp: top 10 most important features and their associated values
feat_imp <- read_csv("/Volumes/G-DRIVE mobile/CaseStudy2/feat_imp.csv")

# accuracy_table: accuracy table representing the 5 main sensors
accuracy_table <- read_csv("/Volumes/G-DRIVE mobile/CaseStudy2/accuracy_table.csv")

# full_accuracy_table: accuracy table depicting differences among devices
full_accuracy_table <- read_csv("/Volumes/G-DRIVE mobile/CaseStudy2/full_accuracy_table.csv")

# full_data: represents all 2 GB of the data, prior to performed operations
full_data <- read_csv("/Volumes/G-DRIVE mobile/CaseStudy2/amusement_and_stress.csv")
```

# Introduction

Wearable technologies have become increasingly prevalent recently, with public interest taking note of the accessibility, health interests, and innovation [[1]][Bibliography]. While these devices are commonly marketed as a valuable communication interface for their users, they also provide a wide array of health monitoring features, such as electrocardiography (ECG), heart rate variability (HRV), and accelerometry (ACC) [[2,3,4]][Bibliography]. Therefore, health-conscious consumers have increasingly adopted wearables [[1,5,6]][Bibliography]. For example, in exploring consumers' health beliefs and percieved usefulness of wearable healthcare technology, Cheung et al.(2019) found that consumers cite health information accuracy as a primary motivating factor for wearable use [[7]][Bibliography].

One line of scholarship is focused on the effectiveness of detecting stress through wearable technologies [[8]][Bibliography]. Stress, as defined, is a critical mental and physical state of health, denoted historically as a "general anxiety" [[9]][Bibliography]. It is well-established that stress leads to a number of long-term health conditions, ranging from headaches and sleep issues to an increased risk of cardiovascular disease [[2,5,8]][Bibliography]. For this reason, researchers have been interested in establishing and interpreting models to predict the affective state of stress using information from wearable devices [[8]][Bibliography].

A challenge in the detection of stress from wearable data is its physiological similarity to the state of amusement [[10]][Bibliography]. The two states share physiological responses to stimuli that trigger a mixture of hormones like cortisol and adrenaline, thus increasing heart rate and muscle tension [[3,8]][Bibliography], which is difficult to discern in biological monitoring data [[11]][Bibliography]. Therefore, this paper will focus on building a model to discern between a state of stress and a state of amusement using the WESAD database [[8]][Bibliography], which used a **RespiBAN Professional** chest-device and **Empatica E4** wrist-device to collect sensor data. We expand previous work by exploring a wide array of modeling techniques, including a stacking ensemble strategy. In addition to determining whether the engineered features in discriminating between stress and amusement were *useful*, we also want to answer *how* they were useful, which ones were *most* useful, if detecting between the states is effective using only the **Empatica E4** data, and a quantified analysis of the heterogeneity across individuals in the dataset.

# Data

## Data Description

The data comes from the WESAD database [[8]][Bibliography]. Raw sensor data was recorded on 17 subjects monitored with wearable devices across changing affective states. However, data of 2 of the subjects were discarded due to sensor malfunction. The data were recorded for each of the subjects with a chest-device (RespiBAN) and wrist-device (E4). In our analysis, we focused on the synchronised raw sensor data labels, which were determined by subjects performing a double tapping gesture. In summary, these were the predictors for each of the subjects: electrocardiogram (ECG), electrodermal activity (EDA), skin temperature (TEMP), electromyogram (EMG), respiration (RESP), and 3-axis accelerometer (ACC) from the **RespiBAN Professional** at 700 Hz, and blood volume pulse (BVP), electrodermal activity (EDA), skin temperature (TEMP), and 3-axis accelerometer (ACC) from the **Empatica E4** at 64 Hz, 4 Hz, 4 Hz, and 32 Hz, respectively.
 
## Feature Extraction

Additional feature extraction was performed on the raw signal data in order to derive important aspects of the data, which was inspired by the WESAD paper. We did this using the Python package **neurokit2** [[12]][Bibliography]. The process for calculating these features uses rolling subsetted windows, and this accomodates downsampling concerns since we aren't lowering the sampling rate of the raw signals that were sampled at a higher frequency. We chose to use features which aggregate over windows as opposed to using raw sensor data because, otherwise, we would need to upsample or downsample the data from each sensor to ensure they are all at the same resolution. We attempted both methods for the purposes of sensitivity analysis, but diregarded them for different reasons. For downsampling, the feature calculation functions from **neurokit2** would not accept input at resolutions below 6 Hz. For upsampling, we imputed intermediate points using distance-weighted K-Nearest Neighbors regression but found that the curves in the end were too noisy and the features calculated from these upsampled values differed too strongly from those calculated from the original signal, as a result of added noise. Because of these limitations, we aggregates over windows using the original signal.

We subsetted the raw signal data into 100-second rolling windows in Python. It was necessary to subset the data into the 100-second windows in order to calculate the features for each of the windows, which is a methodology practiced by Schmidt et al. (2018) [[12]][Bibliography]. We chose to take 100-second windows at even 50 second intervals. Other work has used far smaller intervals between windows, but a small interval implies that neighboring windows will be built from much of the same data, resulting in a problematic temporal dependence among variables. Our attempt to limit this effect was in increasing the size of intervals between adjacent windows. Table 1 shows a summary of our extracted features that we used for our modeling. More information on the terms can be found in the appendix [[13,14]][Bibliography].

```{r}
data_table %>%
  kableExtra::kable(booktabs = T,
                    caption = "Feature Engineering with the WESAD Sensor Data",
                    col.names = c("Sensors", "Features", "# of features")) %>%
  kable_styling(latex_options = c("hold_position")) %>%
  kable_styling(font_size = 8) %>%
  pack_rows("RespiBAN Professional", 1, 4) %>%
  pack_rows("Empatica E4", 5, 8) %>%
  footnote(symbol = "HR/V = Heart rate/variability | SCL/R = Skin conductance level/response | I/EHD = Inhale/exhale duration") %>% 
  row_spec(0, bold = TRUE)
```
 
## Exploratory Data Analysis

Partial Least Squares (PLS) is a dimensionality reduction method similar to Principal Components Analysis (PCA). The aim of Partial Least Squares is to project each observation of predictors onto a fixed number of independent hyperplanes such as to maximize the explained variance in the response. This way, we can place observations into a lower dimensional space that groups points with similar characteristics, much like in PCA, however it gives priority to similar characteristics that help effectively predict the response. This analysis adds two elements to EDA. First, we can plot each observation along its Partial Least Squares decomposition axes. If we see that the observations with similar values of the response cluster together in that space, then that implies our predictors as a whole can explain a high level of variation in the response. As we see in Figure 1, we observe such clustering in our dataset.

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center', fig.cap="Detecting Stress and Amusement Using PLS"}
knitr::include_graphics(c("pls.png"))
```

Additionally, we were interested in looking at the relationships between the raw sensor data and the response (stress vs. amusement) in each of the fifteen participants in the study. We created density plots of the raw data for each type of sensor data for each subject participant, colored by stress versus amusement. Due to the quantity of these plots, they are located in the Appendix. We found that across all fifteen subjects, stress and amusement are perfectly separated by the values of EDA and temperature. Because of the small sample size of the study, it is difficult to draw conclusions from this. It is possible that this perfect separation constitutes a true relationship between EDA or temperature and stress, but it is also possible that this is an anomoly that could impact the effectiveness of our models. We hope to make no assumption either way and find models that generalize well across subjects. We exclude interaction terms between subjects and EDA/temperature variables to ensure the model doesn't overfit to these specific splits. We also check for multicollinearity through correlation plots, which are included in the appendix. 

```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S2") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)

# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data, With Removed Outliers",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center', fig.cap="Density of Raw Sensor Data (Chest-Data Only for Subject 2)"}
knitr::include_graphics(c("EDA_vis.png"))
```

# Methodology and Results

In this section, we explain our modeling strategy to predict whether a person is in a state of stress (1) or amusement (0) based on the features calculated from the WESAD sensor data. As explained, the data is high-dimensional and highly-correlated. Therefore, several models were chosen to avoid these complications. We chose to prioritize model accuracy over interpretability; however, two of our chosen models provide interpretations of coefficient effects in addition to strong out-of-sample performance.

First, we fit a logistic regression model with a lasso (L1) penalty. This model expands upon ordinary logistic regression by including a penalty on the sum of the absolute values of coefficients. In practice, this shrinks coefficients towards zero, performing variable selection by removing unimportant variables. These models can be effective out-of-sample, even when multicollinearity and high-dimensionality are concerns. The model allows an interpretation of coefficient effects as well, but an effect of including the L1 penalty is that we cannot construct asymptotic confidence intervals or hypothesis tests on coefficients. Coefficients are interpreted the same as in logistic regression. In our models, we performed standardization on each variable prior to fitting, so relative coefficient importance can be judged by absolute value. Table 2 includes a list of chosen covariates and their corresponding coefficients from the model fit on all sensors.

```{r}
lasso_c %>%
  mutate_if(is.numeric, round, digits=3) %>%
  kableExtra::kable(booktabs = T,
                    caption = "Top 10 Lasso Logistic Regression Output") %>%
  kable_styling(latex_options = c("hold_position")) %>%
  kable_styling(font_size = 8)
```
Next, we perform gradient boosting tree classification using XGBoost. This nonlinear model uses an ensemble of tree-based classifiers. An advantage is that feature importance values can be computed. These describe for each covariate how much the model improves based on splits on that variable. This gives another metric for determining important variables. Variables with highest feature importance are included with their corresponding values in Table 3. 
 
```{r}
feat_imp %>%
  mutate_if(is.numeric, round, digits=3) %>%
  kableExtra::kable(booktabs = T,
                    caption = "Top 10 Feature Importance From XGBoost Model") %>%
  kable_styling(latex_options = c("hold_position")) %>%
  kable_styling(font_size = 8)
```
 
We also chose a number of models to serve as black-box classifiers. These include support vector machine classifiers with linear, polynomial, and RBF kernels. We additionally fit support vector machine classifiers which use two-dimensional embeddings from a PLS decomposition as input, based on the strong clustering result shown in the exploratory data analysis.

Lastly, we created two stacking ensemble classifiers. These models take as input the predictions from other machine learning models and fit a separate classifier to make a final prediction. We used a lasso logistic regression as the final classifier. 

To assess model performance, we performed 15-fold cross validation on random folds to provide an estimate of out-of-sample accuracy as well as F1 score. F1 score is the harmonic mean of precision and recall, and is better equipped for evaluating binary classification models when there is class imbalance in the data. It balances precision, the proportion of positively-predicted values that were correctly predicted positive, and recall, the proportion of all true positives that were correctly classified. We decided to use random folds as opposed to LOOCV  due to our interest in accounting for heterogeneity using main effects on the subjects.

15-fold cross validation was performed to choose model hyperparameters. For a full listing of hyperparameters tuned and utilized in the final models, please email nmo4@duke.edu.

## Effectiveness of Wrist Sensor vs. Chest Sensor

We are interested not just in whether we can create an accurate model based on the data from WESAD, but also whether each sensor can be used individually to distinguish stress and amusement, and also whether the wrist-based wearable on its own can perform effectively. Since a wrist-worn sensor is convenient for daily use, a model using only the wrist-worn wearable would be especially pragmatic.
 
To address this, we performed the entire above modeling procedure using a number of subsets of the data: one for each individual sensor; one with all the variables from the chest sensor; one with all the variables from the wrist sensor. The effectiveness of each model are shown in Table 4 for the total sensor models and in the Appendix for the individual sensor models. We found that the chest data alone was most effective in classifying stress versus amusement, but models using just the data from the wrist-worn wearable and models using all data were effective. The sensors alone (ACC, BVP, ECG, EDA, and RESP) additionally provided generally accurate predictions, but not as effective as in conjunction.
 
```{r}
full_accuracy_table %>%
  mutate_if(is.numeric, round, digits=3) %>%
  kableExtra::kable(booktabs = T,
                    caption = "Accuracy (Acc) and F1 Scores for Devices on 15-Fold Cross Validation",
                    col.names = c("", "Acc", "F1",
                                  "Acc", "F1",
                                  "Acc", "F1")) %>%
  kable_styling(latex_options = c("hold_position")) %>%
  kable_styling(font_size = 8) %>%
  add_header_above(c(" "= 1, "All Variables" = 2, "Chest Sensor Data" = 2, "Wrist Sensor Data" = 2))
```

As can be verified in Tables 4 and the table in the Appendix, the models using all chest, wrist, or combined chest-wrist data perform better than the naive predictor that chooses the more common class every time, which achieves an accuracy score of 0.672 and an F1 score of 0.803. The best performing model overall is the XGBoost classifier trained on data from the chest-worn device only. Across the board, the XGBoost classifiers performed best, while the Lasso logistic regression and SVM models are also individually effective. Interestingly, the stacking ensemble classifiers were not as effective as the individual component models.

## Interpretation of Coefficients
 
```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center', fig.cap="Predicted Probabilities of Stress (Versus Amusement)"}
knitr::include_graphics(c("coef_plot.png"))
```

We chose a wide array of models with the primary goal of maximizing model performance over the secondary goal of model interpretability. Model performance was privileged due to the importance of the application to real-world scenarios in which the end-user of a wearable device is interested in monitoring stress for health-related reasons. We felt that interpretability was of less relevance to the end-user than model accuracy, especially given the preexisting research that has been done on biological markers of stress. It is crucial to understand which sensor data is driving our models for future decisions regarding the usefulness of specific sensors and to gain a better understanding of the difference between the bodily reaction to stress and amusement.

We included a table of the top ten most important features by both Lasso logistic regression and XGBoost classification from the models with the combined sensor data. In Lasso logistic regression, we are able to interpret the coefficients with the largest absolute values as most significant because of preprocessing standardization. That is, for a variable $X$ in the data, we convert it to $X_{new} = \frac{X - mean(X)}{SD(X)}$. We are ensuring that all coefficients are on the same scale. To interpret these Lasso logistic regression coefficients, then, for any covariate $X_i$ with logistic regression coefficient $\beta_i$, the log-odds of the state being stressed as opposed to amused are predicted by the model to increase by $\beta_i$ with every one standard deviation increase in $X_i$. Variables with a higher absolute value of coefficient affect the model the most.

For the variables with the top ten highest absolute value lasso coefficients, Figure 3 shows a plot of the predicted probability of being stressed versus being amused for values between -2 and 2 standard deviations away from the mean, given an average value for all other variables. From this, we can describe the trends the model has found between the sensor data and the likelihood of being stressed. For example, we see that for the two variables with the highest coefficients, "HRV_MedianNN" and "HRV_MeanNN", the probability that one with average values for all other variables is stressed becomes very high only when these variables are low. When they become significantly above average, the probability that the person is amused instead is very high. We additionally find various relationships regarding EDA variables. For instance, when the sum of startle magnitudes is high, an average person in our model is likely to be stressed, which could mean that if the person is being shocked repeatedly by stimuli, they are more likely to be stressed. Interestingly, the slope of EDA has the reverse relationship, indicating that if, in a 100 second window, the EDA values change from high to low, the person is more likely to be stressed than the other way around. Lastly, we see that high blood volume pulse is predicted to associate with high levels of stress, which follows from intuition that heart rate increases with stress.

The feature importance values from XGBoost classification are more challenging to interpret, given they are meant to quantify improvement in a complicated ensemble of tree-based classifiers based on an individual variable. There is no closed-form equation for feature importance and the magnitude of a feature importance value itself should not be interpreted, only relative to other feature importances from the same model. That being said, we do see EDA and HRV variables in the top ten most important, agreeing with the Lasso model. However, we also see it favoring temperature as well in multiple places. A limitation of our approach is that, while the XGBoost model was able to capture a nonlinear relationship between temperature and stress versus amusement, we are not able to visualize that relationship, and can't provide an interpretation of it. We know that temperature was a strong component of our most effective model, however, so it does indicate the veracity of using the temperature sensor for this task. At the same time, for research purposes, it would be good to better understand and study that relationship.

## Heterogeneity Test
 
To quantify the heterogeneity across individuals, the feature with the largest coefficient in the lasso model from each of the individual devices was processed into a logistic regression model to predict stress vs. amusement with stress as the baseline. The fitted logistic model fit the most important predictors (`HRV_MeanNN`, `eda_slope_wr`, `bvp_nintieth_quantile`, `acc_x_mean`, `temp_wr_standard_deviation`, and `ie_ratio`), indicator variables associated with each of the subjects, and the interaction terms between the indicator variables and the most important predictors. This is illustrated by the model:

$$\log(\dfrac{p}{1-p}) = \beta_0 + \beta_1 * HRVMeanNN + \beta_2 * EdaSlopeWr + \beta_3 * BVPNintiethQuantile +$$

$$\beta_4 * ACCXMean + \beta_5 * TempWrStandardDeviation + \beta_6 * IERatio$$
Where the baseline probability is associated with the stress label. 

There was a fitted model with all of the predictors, indicator variables associated with each of the subjects, and the interaction terms between the indicator variables and the most important predictors. Additionally, multiple models that included one of the predictors, indicator variables associated with each of the subjects, and the interaction terms between the indicator variables and the singular predictor, were created.

From the fitted logistic regression model, it was found that all of the interaction terms were insignificant. This is true for the model containing all of the predictors, and the multiple models that had one predictor included in the model. This indicates that the relationship between each of the chosen features calculated from the wearable sensors had a consistent relationship with stress vs. amusement, even across subjects. This holds in spite of the fact that individual subjects may have been more likely to become stressed or amused in general, as evidenced by some subject main effects’ inclusion in the XGBoost feature importance chart and lasso logistic regression. At the same time, we cannot assert any homogeneity at a broader scale due to the lack of diversity in the population studied, which consisted largely of young men.

# Conclusion

After running a wide array of interpretable and black-box machine learning models, we determined that data from the Empirica E4 and RespiBAN devices can be used to accurately distinguish states of stress and states of amusement. We found that, while using both devices is preferable, data from the wrist-worn device alone is enough to create a sufficient model. Beyond this, many of the individual sensors alone provide enough relevant data for a reasonable classifier. Interpreting our models, we found that heart rate variability and data from the EDA were most helpful in predicting affective state. Lastly, we found that the effects impacting a likelihood of stress over amusement behave homogeneously across participants. While these results are encouraging, further study is needed to ensure that a model would work more broadly, given the homogeneity of participants in the original WESAD study, which consisted primarily of young men.

# Appendix


## Bibliography

1. Lee, Sang Yup, and Keeheon Lee. “Factors That Influence an Individual's Intention to Adopt a Wearable Healthcare Device: The Case of a Wearable Fitness Tracker.” Technological Forecasting &amp; Social Change, vol. 129, 2018, pp. 154–163., doi:10.1016/j.techfore.2018.01.002.

2. Murphy, Jane Louise, et al. “The Use of Wearable Technology to Measure Energy Expenditure, Physical Activity, and Sleep Patterns in Dementia.” Alzheimer's &amp; Dementia: The Journal of the Alzheimer's Association, vol. 11, no. 7, 2015, pp. P188–P188., doi:10.1016/j.jalz.2015.07.165.

3. Nixon, Jim, and Rebecca Charles. “Understanding the Human Performance Envelope Using Electrophysiological Measures from Wearable Technology.” Cognition, Technology &amp; Work, vol. 19, no. 4, 2017, pp. 655–666., doi:10.1007/s10111-017-0431-5.

4. Prieto, L. P., et al. “Multimodal Teaching Analytics: Automated Extraction of Orchestration Graphs from Wearable Sensor Data.” Journal of Computer Assisted Learning, vol. 34, no. 2, 2018, pp. 193–203., doi:10.1111/jcal.12232. Accessed 29 Sept. 2020. 

5. Jakicic, John M., et al. “Effect of Wearable Technology Combined With a Lifestyle Intervention on Long-Term Weight Loss: The IDEA Randomized Clinical Trial.” JAMA : the Journal of the American Medical Association, vol. 316, no. 11, 2016, pp. 1161–1171., doi:10.1001/jama.2016.12858.

6. Bai, Yang, et al. “Comparative Evaluation of Heart Rate-Based Monitors: Apple Watch vs Fitbit Charge HR.” Journal of Sports Sciences, vol. 36, no. 15, 2017, pp. 1734–1741., doi:10.1080/02640414.2017.1412235.

7. Cheung, Man Lai, et al. “Examining Consumers’ Adoption of Wearable Healthcare Technology: The Role of Health Attributes.” International Journal of Environmental Research and Public Health, vol. 16, no. 13, 2019, p. 2257., doi:10.3390/ijerph16132257.

8. Schmidt, Philip, et al. “Introducing WESAD, a Multimodal Dataset for Wearable Stress and Affect Detection.” Proceedings of the 2018 on International Conference on Multimodal Interaction - ICMI '18, 2018, doi:10.1145/3242969.3242985. 

9. Abbott, Andrew. “Positivism and Interpretation in Sociology: Lessons for Sociologists from the History of Stress Research.” Sociological Forum (Randolph, N.J.), vol. 5, no. 3, 1990, pp. 435–458., doi:10.1007/BF01115095.

10. Schmidt, Philip, et al. “Wearable-Based Affect Recognition—A Review.” Sensors, vol. 19, no. 19, 2019, p. 4079., doi:10.3390/s19194079. 

11. Schmidt, Philip, et al. “Labelling Affective States ‘in the Wild.’” Proceedings of the 2018 ACM International Joint Conference and 2018 International Symposium on Pervasive and Ubiquitous Computing and Wearable Computers - UbiComp '18, 2018, doi:10.1145/3267305.3267551. 

12. Makowski, D., Pham, T., Lau, Z. J., Brammer, J. C., Lesspinasse, F., Pham, H., Schölzel, C., & S H Chen, A. (2020). NeuroKit2: A Python Toolbox for Neurophysiological Signal Processing. Retrieved March 28, 2020, from https://github.com/neuropsychology/NeuroKit.

13. Shvedko, Alexander G., et al. “Influence of the Skeletal Muscle Activity on Time and Frequency Domain Properties of the Body Surface ECG during Evolving Ventricular Fibrillation in the Pig.” Resuscitation, vol. 78, no. 2, 2008, pp. 215–223., doi:10.1016/j.resuscitation.2008.03.010. 

14. Ciccone, Anthony B., et al. “Reminder: RMSSD and SD1 Are Identical Heart Rate Variability Metrics.” Muscle &amp; Nerve, vol. 56, no. 4, 2017, pp. 674–678., doi:10.1002/mus.25573. 


## Additional EDA

Chest-Data Raw Sensor Data on ALL participants (minimized and we showed only for subject 2 in the paper)

```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S3") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)

# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 3)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis3.png")

```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis3.png"))
```


```{r results = 'hide' , eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S4") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)

# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 4)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis4.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis4.png"))
```

```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S5") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)

# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 5)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis5.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis5.png"))
```

```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S6") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)

# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 6)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis6.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis6.png"))
```


```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S7") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)
# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 7)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis7.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis7.png"))
```


```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S8") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))
raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)
# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 8)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis8.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis8.png"))
```


```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S9") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)
# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 9)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis9.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis9.png"))
```


```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S10") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)
# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 10)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis10.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis10.png"))
```


```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S11") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)
# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 11)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis11.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis11.png"))
```


```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S13") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)
# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 13)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis13.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis13.png"))
```


```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S14") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)

# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 14)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis14.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis14.png"))
```


```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S15") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)

# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 15)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis15.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis15.png"))
```


```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S16") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)

# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 16)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis16.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis16.png"))
```


```{r results = 'hide', eval=FALSE}
set.seed(1)
raw_sampled <- full_data %>%
  filter(subject == "S17") %>%
  mutate(Condition = ifelse(label == 2, "Stress", "Amusement"))

raw_sampled <- raw_sampled %>%
  filter(Condition == "Amusement") %>%
  # arrange(desc(X1)) %>%
  mutate(new_id = row_number()) %>%
  rbind(raw_sampled %>%
          filter(Condition == "Stress") %>%
          # arrange(desc(X1)) %>%
          mutate(new_id = row_number()))

p1 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ACC_x)) %>%
  filter(ACC_x > quantile(ACC_x, probs = 0.25) - (1.5 * IQR(ACC_x)),
         ACC_x < quantile(ACC_x, probs = 0.75) + (1.5 * IQR(ACC_x))) %>%
  ggplot(aes(x=ACC_x, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ACC: X (g)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p2 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(ECG)) %>%
  filter(ECG > quantile(ECG, probs = 0.25) - (1.5 * IQR(ECG)),
         ECG < quantile(ECG, probs = 0.75) + (1.5 * IQR(ECG))) %>%
  ggplot(aes(x=ECG, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("ECG (mV)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p3 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(EDA_y)) %>%
  filter(EDA_y > quantile(EDA_y, probs = 0.25) - (1.5 * IQR(EDA_y)),
         EDA_y < quantile(EDA_y, probs = 0.75) + (1.5 * IQR(EDA_y))) %>%
  ggplot(aes(x=EDA_y, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("EDA (mu-s)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p4 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Temp)) %>%
  filter(Temp > quantile(Temp, probs = 0.25) - (1.5 * IQR(Temp)),
         Temp < quantile(Temp, probs = 0.75) + (1.5 * IQR(Temp))) %>%
  ggplot(aes(x=Temp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("TEMP (C)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p5 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(Resp)) %>%
  filter(Resp > quantile(Resp, probs = 0.25) - (1.5 * IQR(Resp)),
         Resp < quantile(Resp, probs = 0.75) + (1.5 * IQR(Resp))) %>%
  ggplot(aes(x=Resp, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("RESP (%)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

p6 <- raw_sampled %>%
  mutate(Condition = as.factor(Condition)) %>%
  filter(!is.na(BVP)) %>%
  filter(BVP > quantile(BVP, probs = 0.25) - (1.5 * IQR(BVP)),
         BVP < quantile(BVP, probs = 0.75) + (1.5 * IQR(BVP))) %>%
  ggplot(aes(x=BVP, fill = Condition)) +
  geom_density() +
  theme_classic() +
  ylab("") + xlab("BVP (PPG)") +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_row <- cowplot::plot_grid(p1, p2, p3, p4, p5, p6, 
                   ncol = 2, align = 'v', axis = 'lr', label_size = 8)
# now add the title
title <- ggdraw() +
  draw_label(
    "Density of Raw Sensor Data (Chest-Data Only for Subject 17)",
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )
plot_grid(
  title, plot_row,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)

ggsave("EDA_vis17.png")
```

```{r out.width="75%",out.height="75%",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("EDA_vis17.png"))
```

Table of 10 most correlated engineered features ($\rho > 0.7$):

```{r correlations, warning=FALSE}
# remove columns w NAs, remove subject, remove identifier column X1
final_na <- final[, colSums(is.na(final)) != nrow(final)] %>% dplyr::select(-subject, -X1)

# remove label (the amusemet or stress identifier variable) to do correlation analysis
final_na$label <- NULL
# rename
d <- final_na
# apply correlations
zv <- apply(final_na, 2, function(x) length(unique(x)) == 1)
dfr <- final_na[, !zv]
n=length(colnames(dfr))
corr.d <- cor(dfr[,1:n],use="complete.obs")
# NAs on the diagonal
corr.d[ lower.tri( corr.d, diag = TRUE ) ] <- NA

# sort pairs of correlated variables
m <- melt(corr.d)
m <- m[order(- abs(m$value)), ]
# get rid of NAs
m <- na.omit(m)
# view the highest correlated: correlation vals > 0.7
(check <- as.data.frame(m[ which( m$value > 0.7 ), ]) %>% head(10))
```

Correlation plot with all engineered features:

```{r}
# plot the correlations
corrplot(corr.d, type = "upper", diag = FALSE , method = "color",
         tl.pos = "td", tl.cex = 0.25)
```

Correlation plot with least correlated engineered features ($\rho < 0.7$):

```{r}
# recall corr without the diagonal transformation
corr.d <- cor(dfr[,1:n],use="complete.obs")
# determine the variables most important with cutoff at 0.7
highlyCorrelated <- findCorrelation(corr.d, cutoff=(0.7),verbose = FALSE)
important_var <- colnames(corr.d[,-highlyCorrelated])
non_important_var <- colnames(corr.d[,highlyCorrelated])

# recreate the correlation plot
final_select <- final_na %>%
  select(c(important_var))

# apply correlations
zv1 <- apply(final_select, 2, function(x) length(unique(x)) == 1)
dfr1 <- final_select[, !zv1]
n=length(colnames(dfr1))
corr.d1 <- cor(dfr1[,1:n],use="complete.obs")
# NAs on the diagonal
corr.d1[ lower.tri( corr.d1, diag = TRUE ) ] <- NA

corrplot(corr.d1, type = "upper", diag = FALSE , method = "color",
         tl.pos = "td", tl.cex = 0.25)
```

Correlation plot with most correlated engineered features ($\rho > 0.7$): 

```{r}
# recreate the correlation plot
final_select1 <- final_na %>%
  select(c(non_important_var))

# apply correlations
zv1 <- apply(final_select1, 2, function(x) length(unique(x)) == 1)
dfr1 <- final_select1[, !zv1]
n=length(colnames(dfr1))
corr.d12 <- cor(dfr1[,1:n],use="complete.obs")
# NAs on the diagonal
corr.d12[ lower.tri( corr.d12, diag = TRUE ) ] <- NA

corrplot(corr.d12, type = "upper", diag = FALSE , method = "color",
         tl.pos = "td", tl.cex = 0.25)
```


## Accuracy Table for cross-validation

```{r}
accuracy_table %>%
  mutate_if(is.numeric, round, digits=3) %>%
  kableExtra::kable(booktabs = T,
                    caption = "Accuracy (Acc) and F1 Scores for Sensor Data on 15-Fold Cross Validation",
                    col.names = c("", "Acc", "F1",
                                  "Acc", "F1",
                                  "Acc", "F1",
                                  "Acc", "F1",
                                  "Acc", "F1",
                                  "Acc", "F1")) %>%
  kable_styling(latex_options = c("hold_position")) %>%
  kable_styling(font_size = 8) %>%
  add_header_above(c(" "= 1, "ACC" = 2, "BVP" = 2, "ECG" = 2, 
                     "EDA (Chest)" = 2, "EDA (Wrist)" = 2, "RESP" = 2))
```